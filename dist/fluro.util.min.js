angular.module("fluro.util",["fluro.config"]),angular.module("fluro.util").service("CacheManager",function($resource,$cacheFactory){var controller={};return controller.clear=function(type){var cache=$cacheFactory.get(type+"-list");cache&&(console.log("Clear Cache",type),cache.removeAll())},controller}),angular.module("fluro.util").service("CollectionManager",function(Collection){var controller={},collections={};return controller.collection=function(key){return collections[key]||(collections[key]=new Collection),collections[key]},controller}).factory("Collection",function(){var Collection=function(){var collection=this;collection.items=[],collection.multiInstance=!1,collection.trackValue="_id";var _minimum=0,_maximum=0;return collection.contains=function(item){var id=item;if(_.isObject(item)){if(!item.hasOwnProperty(collection.trackValue))return console.log("Undefined track value: ",collection.trackValue,"For item",item),!0;id=item[collection.trackValue]}var result=_.any(collection.items,function(existingItem){return _.isObject(existingItem)?existingItem.hasOwnProperty(collection.trackValue)?existingItem[collection.trackValue]==id:existingItem:existingItem==id});return result},collection.toggle=function(item){var alreadySelected=collection.contains(item);alreadySelected?collection.remove(item):collection.add(item)},collection.add=function(item){return _.isObject(item)&&!item.hasOwnProperty(collection.trackValue)?void console.log("Track value '"+collection.trackValue+"' Not found on proposed item",item):collection.contains(item)&&!collection.multiInstance?void console.log("Only allowed one instance of item",item):_maximum&&collection.items.length>=_maximum?void(1==_maximum&&collection.only(item)):(collection.items.push(item),!0)},collection.removeDuplicates=function(){collection.items=_.uniq(collection.items,function(item){return _.isObject(item)&&item.hasOwnProperty(collection.trackValue)?item[collection.trackValue]:item})},collection.addMultiple=function(array){collection.items=collection.items.concat(array),collection.multiInstance||collection.removeDuplicates()},collection.only=function(item){collection.items.length=0,collection.add(item)},collection.onlyMultiple=function(items){collection.items=items,collection.multiInstance||collection.removeDuplicates()},collection.remove=function(item){var id=item;_.isObject(item)&&(id=item[collection.trackValue]),_.remove(collection.items,function(existingItem){return _.isObject(existingItem)&&existingItem.hasOwnProperty(collection.trackValue)?existingItem[collection.trackValue]==id:existingItem==id})},collection.removeMultiple=function(array){_.remove(collection.items,function(existingItem){return _.contains(array,existingItem)})},Object.defineProperty(collection,"ids",{get:function(){return _.map(collection.items,function(item){return _.isObject(item)&&item.hasOwnProperty("_id")?item._id:item})}}),collection.clear=function(){collection.items.length=0},Object.defineProperty(collection,"length",{get:function(){return collection.items.length}}),Object.defineProperty(collection,"minimum",{get:function(){return _minimum},set:function(m){_minimum=m}}),Object.defineProperty(collection,"maximum",{get:function(){return _maximum},set:function(m){_maximum=m}}),collection.set=function(array){collection.items=array},collection};return Collection}),angular.module("fluro.util").service("Content",function($resource,$cacheFactory,Fluro){var controller={};return controller.genericResource=function(type,ignoreLoadingBar,noCache){var cache=$cacheFactory.get(type+"-list");return cache||(console.log("Creating ",type+"-list"),cache=$cacheFactory(type+"-list")),noCache&&(cache=!1),console.log("Get Generic",type),$resource(Fluro.apiURL+"/generic/"+type+"/:id",{},{update:{method:"PUT"},query:{method:"GET",isArray:!0,cache:cache,ignoreLoadingBar:!0},batch:{method:"POST",ignoreLoadingBar:!0}})},controller.resource=function(type,ignoreLoadingBar,noCache){var cache=$cacheFactory.get(type+"-list");return cache||(console.log("Creating ",type+"-list"),cache=$cacheFactory(type+"-list")),noCache&&(cache=!1),$resource(Fluro.apiURL+"/"+type+"/:id",{},{update:{method:"PUT",ignoreLoadingBar:ignoreLoadingBar},save:{method:"POST",ignoreLoadingBar:ignoreLoadingBar},query:{method:"GET",isArray:!0,cache:cache,ignoreLoadingBar:!0},batch:{method:"POST",ignoreLoadingBar:!0}})},controller}),angular.module("fluro.util").factory("DateTools",function(){var controller={};return controller.readableDateRange=function(startDate,endDate){_.isDate(startDate)||(startDate=new Date(startDate)),_.isDate(endDate)||(endDate=new Date(endDate));var today=new Date,string="";return startDate.format("d/m/y")!=endDate.format("d/m/y")?(string=startDate.format("M Y")==endDate.format("M Y")?startDate.format("l j")+" - "+endDate.format("l j F"):startDate.format("l j F")+" until "+endDate.format("l j F"),today.format("Y")!=endDate.format("Y")&&(string=string+" "+endDate.format("Y"))):startDate&&(string=startDate.format("l j F"),today.format("Y")!=startDate.format("Y")&&(string=string+" "+startDate.format("Y"))),string},controller}),angular.module("fluro.util").service("Notifications",function($timeout){var controller={list:[],defaultDelay:2e3};return controller.warning=function(text,delay){controller.post(text,"warning",delay)},controller.error=function(text,delay){controller.post(text,"error",delay)},controller.status=function(text,delay){controller.post(text,"status",delay)},controller.post=function(text,type,delay){"undefined"==typeof type&&(type="status"),"undefined"==typeof delay&&(delay=controller.defaultDelay);var msg={};msg.text=text,msg.type=type,msg.remove=function(){var i=controller.list.indexOf(msg);-1!=i&&controller.list.splice(i,1)},controller.list.push(msg),$timeout(msg.remove,delay)},controller}),angular.module("fluro.util").factory("Playlist",function(){function Playlist(){var _this=this,_items=[],_index=0,_loop=!0,_direction="forwards";return this.__defineSetter__("index",function(i){_direction=_index>i?"backwards":"forwards",i!=_index&&(_index=i)}),this.__defineGetter__("index",function(){return _index}),this.__defineGetter__("direction",function(){return _direction}),this.__defineGetter__("currentItem",function(){return _items[_index]}),this.__defineGetter__("length",function(){return _items.length}),this.indexOf=function(object){return _items.indexOf(object)},this.select=function(object){var i=_items.indexOf(object);-1!=i&&(_this.index=i)},this.__defineGetter__("items",function(){return _items}),this.__defineSetter__("items",function(array){_items=array,_index=0}),this.__defineGetter__("previousEnabled",function(){return _loop?!0:_index>0}),this.__defineGetter__("nextEnabled",function(){return _loop?!0:_index<_items.length-1}),this.__defineGetter__("loop",function(){return _loop}),this.__defineSetter__("loop",function(bol){_loop=bol}),this.next=function(){_index<_items.length-1?_this.index=_index+1:_loop&&(_this.index=0)},this.previous=function(){_index>0?_this.index=_index-1:_loop&&(_this.index=_items.length-1)},this.addItem=function(item){return _items.push(item),item},this.addItemAt=function(item,pos){return _items.splice(pos,0,item),item},this.removeItem=function(item){var _itemIndex=_items.indexOf(item),_result=_items[_itemIndex];return-1!=_itemIndex&&_items.splice(_itemIndex,1),_result},this.clear=function(){_items=new Array,_index=0},_this}return Playlist}),angular.module("fluro.util").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("fluro/ui/columns.html",'<div class=columns><div class="outer cf"><div class=wrapper><div class=column-{{columnWidth}} ng-repeat="item in model"><render ng-model=item></render></div></div></div></div>'),$templateCache.put("fluro/ui/countdown.html",""),$templateCache.put("fluro/ui/gallery.html",'<div class=gallery><div class=outer><div class=wrapper><div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents><div class="gallery-slide slide animated" ng-class={active:isActive(image)} ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-height="1200"></div></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:isActive(item)}><i class=fa ng-class="{\'fa-circle-o\':!isActive(item), \'fa-circle\':isActive(item)}"></i></a></div></div><div class=gallery-thumbs><slider><div class=gallery-thumb ng-class={active:isActive(image)} ng-click=playlist.select(image) ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-width=320 image-height="320"></div></slider></div></div></div></div>'),$templateCache.put("fluro/ui/slide.html",'<div class="slide animated" ng-class="{\'active\':active}" ng-transclude></div>'),$templateCache.put("fluro/ui/slideshow.html",'<div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents ng-transclude></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:item.active}><i class=fa ng-class="{\'fa-circle-o\':!item.active, \'fa-circle\':item.active}"></i></a></div></div>')}]);