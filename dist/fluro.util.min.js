angular.module("fluro.util",["fluro.config","ngStorage"]),function(){Date.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Date.longMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Date.longDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var replaceChars={d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.longDays[this.getDay()]},N:function(){return 0==this.getDay()?7:this.getDay()},S:function(){return this.getDate()%10==1&&11!=this.getDate()?"st":this.getDate()%10==2&&12!=this.getDate()?"nd":this.getDate()%10==3&&13!=this.getDate()?"rd":"th"},w:function(){return this.getDay()},z:function(){var d=new Date(this.getFullYear(),0,1);return Math.ceil((this-d)/864e5)},W:function(){var target=new Date(this.valueOf()),dayNr=(this.getDay()+6)%7;target.setDate(target.getDate()-dayNr+3);var firstThursday=target.valueOf();return target.setMonth(0,1),4!==target.getDay()&&target.setMonth(0,1+(4-target.getDay()+7)%7),1+Math.ceil((firstThursday-target)/6048e5)},F:function(){return Date.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){var d=new Date;return new Date(d.getFullYear(),d.getMonth(),0).getDate()},L:function(){var year=this.getFullYear();return year%400==0||year%100!=0&&year%4==0},o:function(){var d=new Date(this.valueOf());return d.setDate(d.getDate()-(this.getDay()+6)%7+3),d.getFullYear()},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return Math.floor(1e3*((this.getUTCHours()+1)%24+this.getUTCMinutes()/60+this.getUTCSeconds()/3600)/24)},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},u:function(){var m=this.getMilliseconds();return(10>m?"00":100>m?"0":"")+m},e:function(){return"Not Yet Supported"},I:function(){for(var DST=null,i=0;12>i;++i){var d=new Date(this.getFullYear(),i,1),offset=d.getTimezoneOffset();if(null===DST)DST=offset;else{if(DST>offset){DST=offset;break}if(offset>DST)break}}return this.getTimezoneOffset()==DST|0},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":00"},T:function(){return this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1")},Z:function(){return 60*-this.getTimezoneOffset()},c:function(){return this.format("Y-m-d\\TH:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};Date.prototype.format=function(format){var date=this;return format.replace(/(\\?)(.)/g,function(_,esc,chr){return""===esc&&replaceChars[chr]?replaceChars[chr].call(date):chr})}}.call(this),angular.module("fluro.util").filter("capitalizename",function(){return function(text){return text?text.replace(/\w\S*/g,function(txt){var name=txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();return name=name.replace(/Mc[a-z]/,function(k){return"Mc"+k[2].toUpperCase()})}):text}}),angular.module("fluro.util").filter("divide",function(){var func=function(array,chunk){array||(array=[]);var div=Math.floor(array.length/chunk);console.log("Divide by",div);var chunked=_.chunk(array,div);return chunked};return _.memoize(func)}),angular.module("fluro.util").filter("chunk",function(){var func=function(array,chunk){var chunked=_.chunk(array,chunk);return chunked};return _.memoize(func)}),angular.module("fluro.util").filter("formatDate",function(DateTools){return function(dateString,format){var date=DateTools.localDate(dateString);return date.format(format)}}),angular.module("fluro.util").filter("plaintext",function(FluroSanitize){return function(text){return text?FluroSanitize.stripTags(text):text}}),angular.module("fluro.util").filter("trusted",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]).filter("trustedResource",["$sce",function($sce){return function(url){return $sce.trustAsResourceUrl(url)}}]),angular.module("fluro.util").service("CacheManager",function($resource,$cacheFactory){var controller={},_caches=[];return controller.get=function(type){var cache=$cacheFactory.get(type+"-list");return cache||(cache=$cacheFactory(type+"-list"),_caches.push(cache)),cache},controller.clear=function(type){var cache=$cacheFactory.get(type+"-list");cache&&cache.removeAll()},controller.clearAll=function(){_.each(_caches,function(cache){cache.removeAll()})},controller}),angular.module("fluro.util").factory("ContentSelection",function(){var ContentSelection=function(){var controller=this;controller.items=[],controller.multiInstance=!1,controller.trackValue="_id";var _minimum=0,_maximum=0;return controller.contains=function(item){var id=item;if(_.isObject(item)){if(!item.hasOwnProperty(controller.trackValue))return console.log("Undefined track value: ",controller.trackValue,"For item",item),!0;id=item[controller.trackValue]}var result=_.any(controller.items,function(existingItem){return _.isObject(existingItem)?existingItem.hasOwnProperty(controller.trackValue)?existingItem[controller.trackValue]==id:existingItem:existingItem==id});return result},controller.toggle=function(item){var alreadySelected=controller.contains(item);alreadySelected?controller.remove(item):controller.add(item)},controller.add=function(item){return _.isObject(item)&&!item.hasOwnProperty(controller.trackValue)?void console.log("Track value '"+controller.trackValue+"' Not found on proposed item",item):controller.contains(item)&&!controller.multiInstance?void console.log("Only allowed one instance of item",item):_maximum&&controller.items.length>=_maximum?void(1==_maximum&&controller.only(item)):(controller.items.push(item),!0)},controller.removeDuplicates=function(){controller.items=_.uniq(controller.items,function(item){return _.isObject(item)&&item.hasOwnProperty(controller.trackValue)?item[controller.trackValue]:item})},controller.addMultiple=function(array){controller.items=controller.items.concat(array),controller.multiInstance||controller.removeDuplicates()},controller.only=function(item){controller.items.length=0,controller.add(item)},controller.onlyMultiple=function(items){controller.items=items,controller.multiInstance||controller.removeDuplicates()},controller.remove=function(item){var id=item;_.isObject(item)&&(id=item[controller.trackValue]),_.remove(controller.items,function(existingItem){return _.isObject(existingItem)&&existingItem.hasOwnProperty(controller.trackValue)?existingItem[controller.trackValue]==id:existingItem==id})},controller.removeMultiple=function(array){_.remove(controller.items,function(existingItem){return _.contains(array,existingItem)})},Object.defineProperty(controller,"ids",{get:function(){return _.map(controller.items,function(item){return _.isObject(item)&&item.hasOwnProperty("_id")?item._id:item})}}),controller.clear=function(){controller.items.length=0},Object.defineProperty(controller,"length",{get:function(){return controller.items.length}}),Object.defineProperty(controller,"minimum",{get:function(){return _minimum},set:function(m){_minimum=m}}),Object.defineProperty(controller,"maximum",{get:function(){return _maximum},set:function(m){_maximum=m}}),controller.set=function(array){controller.items=array},controller};return ContentSelection}),angular.module("fluro.util").filter("matchDate",function(Fluro){return function(items,dateString,style){var date=new Date(dateString);return _.reduce(items,function(results,item){var startDate,endDate;item.startDate&&(startDate=Fluro.timezoneOffset?controller.localDate(item.startDate):new Date(item.startDate),startDate.setHours(0,0,0,0)),item.endDate&&(startDate=Fluro.timezoneOffset?controller.localDate(item.endDate):new Date(item.endDate)),endDate.setHours(23,59,59,999);var checkTimestamp=date.getTime(),startTimestamp=startDate.getTime(),endTimestamp=endDate.getTime();switch(style){case"upcoming":(startTimestamp>=checkTimestamp||endTimestamp>=checkTimestamp)&&results.push(item);break;default:checkTimestamp>=startTimestamp&&endTimestamp>=checkTimestamp&&results.push(item)}return results},[])}}).service("DateTools",function(Fluro){var controller={};return controller.calculateAge=function(d){var today,birthDate;Fluro.timezoneOffset?(today=controller.localDate(),birthDate=controller.localDate(d)):(today=new Date,birthDate=new Date(d));var age=today.getFullYear()-birthDate.getFullYear(),m=today.getMonth()-birthDate.getMonth();return(0>m||0===m&&today.getDate()<birthDate.getDate())&&age--,age},controller.localDate=function(d){var date;date=d?new Date(d):new Date;var timezoneOffset,browserOffset=date.getTimezoneOffset();if(Fluro.timezone){timezoneOffset=moment.tz(date,Fluro.timezone).utcOffset(),browserOffset=moment(date).utcOffset();{var difference=timezoneOffset-browserOffset,offsetDifference=60*difference*1e3;new Date(date)}date.setTime(date.getTime()+offsetDifference)}return date},controller.expired=function(d){var today,checkDate;return Fluro.timezoneOffset?(today=controller.localDate(),checkDate=controller.localDate(d)):(today=new Date,checkDate=new Date(d)),today>checkDate},controller.isValidDate=function(d){return"[object Date]"!==Object.prototype.toString.call(d)?!1:!isNaN(d.getTime())},controller.readableDateRange=function(startDate,endDate,options){options||(options={}),_.isDate(startDate)||(startDate=Fluro.timezoneOffset?controller.localDate(startDate):new Date(startDate)),_.isDate(endDate)||(endDate=Fluro.timezoneOffset?controller.localDate(endDate):new Date(endDate));var today;today=Fluro.timezoneOffset?controller.localDate():new Date;var string="";return startDate.format("d/m/y")!=endDate.format("d/m/y")?(string=startDate.format("M Y")==endDate.format("M Y")?startDate.format("l j")+" - "+endDate.format("l j F"):startDate.format("l j F")+" until "+endDate.format("l j F"),today.format("Y")!=endDate.format("Y")&&(string=string+" "+endDate.format("Y"))):startDate&&(string=startDate.format("l j F"),today.format("Y")!=startDate.format("Y")&&(string=string+" "+startDate.format("Y"))),string},controller}),angular.module("fluro.util").service("Asset",function(Fluro,$window){var controller={};return controller.getUrl=function(id,extension,params){params||(params={});var url=Fluro.apiURL+"/get/"+id;extension&&(url+="/file/file."+extension),Fluro.token&&!params.access_token&&(params.access_token=Fluro.token);var queryParams=_.map(params,function(v,k){return encodeURIComponent(k)+"="+encodeURIComponent(v)}).join("&");return queryParams.length&&(url+="?"+queryParams),url},controller.thumbnailUrl=function(id){var url=Fluro.apiURL+"/get/"+id+"?w=50";return Fluro.token&&(url+="?access_token="+Fluro.token),url},controller.imageUrl=function(_id,w,h,params){params||(params={});var url=Fluro.apiURL+"/get/"+_id,limitWidth=1920;$window.screen.width<=768&&(limitWidth=1536),$window.screen.width<=320&&(limitWidth=640),w||h?(w&&(params.w=w),h&&(params.h=h)):params.w=limitWidth,Fluro.token&&!params.access_token&&(params.access_token=Fluro.token);var queryParams=_.map(params,function(v,k){return encodeURIComponent(k)+"="+encodeURIComponent(v)}).join("&");return queryParams.length&&(url+="?"+queryParams),url},controller.downloadUrl=function(id){var url=Fluro.apiURL+"/download/"+id;return Fluro.token&&(url+="?access_token="+Fluro.token),url},controller.isAssetType=function(object){switch(object._type){case"asset":case"video":case"audio":case"image":return!0;default:return!1}},controller}),angular.module("fluro.util").service("FluroSanitize",function(){var controller={};return controller.stripTags=function(input,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,result=input.replace(commentsAndPhpTags,"").replace(/\u00A0/g," ").replace(/&nbsp;/g," ").replace(tags,function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""}),element=$("<div>"+result+"</div>");element.find("*").removeAttr("style");var htmlString=element.eq(0).html();return htmlString},controller}),angular.module("fluro.util").service("FluroStorage",function($rootScope,$localStorage,$sessionStorage){var controller={};return controller.resetSessionStorage=function(){$rootScope.user&&($sessionStorage[$rootScope.user._id]={})},controller.resetLocalStorage=function(){$rootScope.user&&($localStorage[$rootScope.user._id]={})},controller.sessionStorage=function(key){return $rootScope.user?($sessionStorage[$rootScope.user._id]||($sessionStorage[$rootScope.user._id]={}),$sessionStorage[$rootScope.user._id][key]||($sessionStorage[$rootScope.user._id][key]={}),$sessionStorage[$rootScope.user._id][key]):void 0},controller.localStorage=function(key){return $rootScope.user?($localStorage[$rootScope.user._id]||($localStorage[$rootScope.user._id]={}),$localStorage[$rootScope.user._id][key]||($localStorage[$rootScope.user._id][key]={}),$localStorage[$rootScope.user._id][key]):void 0},controller}),angular.module("fluro.util").factory("ObjectSelection",function(){var ObjectSelection=function(){var controller={items:[],item:null};return controller.multiple=!0,controller.minimum=0,controller.maximum=0,controller.select=function(item){controller.multiple?_.contains(controller.items,item)||controller.items.push(item):controller.item=item},controller.deselect=function(item){controller.multiple?_.pull(controller.items,item):controller.item=null},controller.toggle=function(item){controller.multiple?_.contains(controller.items,item)?controller.deselect(item):controller.select(item):controller.item=controller.item==item?null:item},controller.contains=function(item){return controller.multiple?_.contains(controller.items,item):controller.item==item},controller};return ObjectSelection}),angular.module("fluro.util").factory("Playlist",function(){function Playlist(){var _this=this,_items=[],_index=0,_loop=!0,_direction="forwards";return this.__defineSetter__("index",function(i){_direction=_index>i?"backwards":"forwards",i!=_index&&(_index=i)}),this.__defineGetter__("index",function(){return _index}),this.__defineGetter__("direction",function(){return _direction}),this.__defineGetter__("currentItem",function(){return _items[_index]}),this.__defineGetter__("length",function(){return _items.length}),this.indexOf=function(object){return _items.indexOf(object)},this.select=function(object){var i=_items.indexOf(object);-1!=i&&(_this.index=i)},this.__defineGetter__("items",function(){return _items}),this.__defineSetter__("items",function(array){_items=array,_index=0}),this.__defineGetter__("previousEnabled",function(){return _loop?!0:_index>0}),this.__defineGetter__("nextEnabled",function(){return _loop?!0:_index<_items.length-1}),this.__defineGetter__("loop",function(){return _loop}),this.__defineSetter__("loop",function(bol){_loop=bol}),this.next=function(){_index<_items.length-1?_this.index=_index+1:_loop&&(_this.index=0)},this.previous=function(){_index>0?_this.index=_index-1:_loop&&(_this.index=_items.length-1)},this.addItem=function(item){return _items.push(item),item},this.addItemAt=function(item,pos){return _items.splice(pos,0,item),item},this.removeItem=function(item){var _itemIndex=_items.indexOf(item),_result=_items[_itemIndex];return-1!=_itemIndex&&_items.splice(_itemIndex,1),_result},this.clear=function(){_items=new Array,_index=0},_this}return Playlist}),angular.module("fluro.util").provider("TypeConfig",function(){var controller={types:[]};return controller.types.push({singular:"Role",plural:"Roles",path:"role",columns:[{title:"Applications",key:"applicationKeys"}]}),controller.types.push({singular:"Family",plural:"Families",path:"family",columns:[{title:"Names",key:"firstLine"}]}),controller.types.push({singular:"Scheduled Task",plural:"Scheduled Tasks",path:"task"}),controller.types.push({singular:"Checkin",plural:"Checkins",path:"checkin",columns:[{title:"Event",key:"event"},{title:"Contact",key:"contact"},{title:"Check in date",key:"created",renderer:"date"},{title:"Checked in time",key:"created",renderer:"time"},{title:"Checked out",key:"checkout.date",renderer:"time"}]}),controller.types.push({singular:"Reaction",plural:"Reactions",path:"reaction"}),controller.types.push({singular:"Policy",plural:"Permission Policies",path:"policy",columns:[{title:"Permissions",key:"permissionSets",renderer:"permissionSet"},{title:"Realm",key:"realms"},{title:"Status",key:"status"}]}),controller.types.push({singular:"Team",plural:"Teams",path:"team",columns:[{title:"Realms",key:"realms",renderer:"multi"},{title:"Tags",key:"tags",renderer:"multi"}],filters:[]}),controller.types.push({singular:"Plan",plural:"Plans",path:"plan",columns:[{title:"Time",key:"startDate",renderer:"time"},{title:"Date",key:"startDate",renderer:"date"},{title:"Realms",key:"realms",renderer:"multi"},{title:"Tags",key:"tags",renderer:"multi"}]}),controller.types.push({singular:"Code",plural:"Code",path:"code",columns:[{title:"Syntax",key:"syntax"}],filters:[{title:"Syntax",key:"syntax"}]}),controller.types.push({singular:"Component",plural:"Components",path:"component"}),controller.types.push({singular:"Query",plural:"Queries",path:"query",columns:[{title:"Limit",key:"limit"}]}),controller.types.push({singular:"Package",plural:"Packages",path:"package"}),controller.types.push({singular:"Contact",plural:"Contacts",path:"contact",columns:[{title:"First Name",key:"firstName",filter:"capitalizename"},{title:"Last Name",key:"lastName",filter:"capitalizename"},{title:"Gender",key:"gender"},{title:"Family",key:"family"}],filters:[{title:"Gender",key:"gender"}]}),controller.types.push({singular:"Contact Details",plural:"Contact Details",path:"contactdetail",columns:[{title:"First Name",key:"contact.firstName"},{title:"Last Name",key:"contact.lastName"}]}),controller.types.push({singular:"Purchase",plural:"Purchases",path:"purchase",columns:[{title:"Customer",key:"owner.name"},{title:"Amount",key:"transaction.amount"},{title:"Transaction",key:"transaction._id"}]}),controller.types.push({singular:"Product",plural:"Products",path:"product",columns:[{title:"Amount",key:"amount"},{title:"License",key:"license"}],filters:[{title:"License",key:"license"}]}),controller.types.push({singular:"Transaction",plural:"Transactions",path:"transaction",columns:[{title:"Amount",key:"amount"},{title:"Payment",key:"paymentStatus"},{title:"Mode",key:"mode"},{title:"Date",key:"created",renderer:"datetime"},{title:"Realms",key:"realms",renderer:"realm"}],filters:[{title:"Payment Status",key:"paymentStatus"},{title:"Mode",key:"mode"}]}),controller.types.push({singular:"Application",plural:"Applications",path:"application",columns:[{title:"Type",key:"applicationType"},{title:"Realms",key:"realms",renderer:"multi"},{title:"Domain",key:"domain"}]}),controller.types.push({singular:"Integration",plural:"Integrations",path:"integration",columns:[{title:"Module",key:"module"}],filters:[{title:"Module",key:"module"}]}),controller.types.push({singular:"Interaction",plural:"Interactions",path:"interaction",columns:[{title:"First Name",key:"contact.firstName"},{title:"Last Name",key:"contact.lastName"}]}),controller.types.push({singular:"Definition",plural:"Definitions",path:"definition",columns:[{title:"Type",key:"parentType"},{title:"Machine Name",key:"definitionName"},{title:"Realms",key:"realms",renderer:"multi"}],filters:[{title:"Basic Type",key:"parentType"}]}),controller.types.push({singular:"Realm",plural:"Realms",path:"realm"}),controller.types.push({singular:"User",plural:"Users",path:"user",columns:[{title:"Permission Policies",key:"policies"},{title:"Extra permissions",key:"permissionSets",renderer:"permissionSet"},{title:"Realm",key:"realms"},{title:"Status",key:"status"}],filters:[{title:"Policies",key:"policies"}]}),controller.types.push({singular:"Event",plural:"Events",path:"event",filters:[{title:"Locations",key:"locations"},{title:"Rooms",key:"rooms"}],viewModes:["calendar","cards"]}),controller.types.push({singular:"Location",plural:"Locations",path:"location",columns:[{title:"Address",key:"addressLine1"},{title:"Suburb",key:"suburb"},{title:"State",key:"state"},{title:"Country",key:"country"}],filters:[{title:"State",key:"state"},{title:"Country",key:"country"}],viewModes:["map"]}),controller.types.push({singular:"Endpoint",plural:"Endpoints",path:"endpoint"}),controller.types.push({singular:"Account",plural:"Accounts",path:"account"}),controller.types.push({singular:"Collection",plural:"Collections",path:"collection",columns:[{title:"Items",key:"items.length"}]}),controller.types.push({singular:"Article",plural:"Articles",path:"article",columns:[{title:"Author",key:"author.name"},{title:"Tags",key:"tags",renderer:"multi"},{title:"Realms",key:"realms",renderer:"multi"}]}),controller.types.push({singular:"Asset",plural:"Assets",path:"asset",columns:[{title:"File Type",key:"extension"},{title:"Tags",key:"tags",renderer:"multi"},{title:"Realms",key:"realms",renderer:"multi"}],filters:[{title:"File Type",key:"extension"}]}),controller.types.push({singular:"Tag",plural:"Tags",path:"tag",filters:[{title:"Type",key:"restrictType"}]}),controller.types.push({singular:"Image",plural:"Images",path:"image",columns:[{title:"Dimensions",key:"width",renderer:"dimensions"},{title:"Tags",key:"tags",renderer:"multi"},{title:"Realms",key:"realms",renderer:"multi"},{title:"Size",key:"filesize",renderer:"filesize"},{title:"Security",key:"privacy",renderer:"privacy"}],filters:[{title:"Asset Type",key:"assetType"}],viewModes:["grid"]}),controller.types.push({singular:"Audio",plural:"Audio",path:"audio",columns:[{title:"Duration",key:"duration"},{title:"Realms",key:"realms",renderer:"multi"},{title:"File Type",key:"extension"},{title:"Security",key:"privacy",renderer:"privacy"}],filters:[{title:"File Type",key:"extension"},{title:"Asset Type",key:"assetType"}]}),controller.types.push({singular:"Video",plural:"Videos",path:"video",columns:[{title:"File Type",key:"extension"},{title:"Duration",key:"duration"},{title:"Realms",key:"realms",renderer:"multi"},{title:"Security",key:"privacy",renderer:"privacy"}],filter:[{title:"File Type",key:"extension"},{title:"Asset Type",key:"assetType"}],viewModes:["grid"]}),controller.types.push({singular:"Site",plural:"Sites",path:"site",columns:[{title:"Realms",key:"realms",renderer:"multi"}]}),{$get:function(){return controller}}}).service("TypeService",function($q,Fluro,FluroContent,FluroAccess,TypeConfig){var controller={};return controller.types=TypeConfig.types,controller.allTypes=function(){return[].concat(controller.types,controller.definedTypes)},controller.getTypeFromPath=function(path){var primitive=_.find(TypeConfig.types,{path:path});if(primitive)return primitive;var defined=_.find(controller.definedTypes,{definitionName:path});return defined?{singular:defined.title,plural:defined.plural,path:defined.definitionName,parentType:defined.parentType}:void 0},controller.isBasicType=function(typeName){return _.some(controller.types,function(type){return type.path==typeName})},controller.sideLoadDefinition=function(definition){if(console.log("Side Load Definition",definition),controller.definedTypes){var exists=_.some(controller.definedTypes,{_id:definition._id});exists||(console.log("Side loaded",definition),controller.definedTypes.push(definition),controller.refreshMenuTree())}},controller.refreshDefinedTypes=function(){return console.log("Refresh defined types"),controller.definedTypes=FluroContent.endpoint("defined",!0,!0).query({allDefinitions:!0}),controller.definedTypes.$promise.then(function(){controller.refreshMenuTree()}),controller.definedTypes},controller.requiredBasicTypes=function(){return _.map(controller.definedTypes,function(def){return def.parentType})},controller.refreshMenuTree=function(){var grouped=_.groupBy(controller.definedTypes,function(defined){return defined.parentType});controller.menuTree=_.chain(controller.types).map(function(type){var children=grouped[type.path],canAccess=FluroAccess.canAccess(type.path);return canAccess&&children&&children.unshift(type),type.children=children,canAccess||children&&children.length?type:null}).compact().value()},controller.getIcon=function(type){return type.parentType?type.parentType:type.path},controller.getAllCreateableTypes=function(){var primitives=_.chain(controller.types).filter(function(type){return FluroAccess.can("create",type.path)}).map(function(type){return type.icon=type.path,type}).value(),defined=_.chain(controller.definedTypes).filter(function(type){return FluroAccess.can("create",type.definitionName)}).each(function(type){type.singular=type.title,type.path=type.definitionName,type.icon=type.parentType}).value();return primitives.concat(defined)},controller}),angular.module("fluro.util").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("fluro/ui/columns.html",'<div class=columns><div class="outer cf"><div class=wrapper><div class=column-{{columnWidth}} ng-repeat="item in model"><render ng-model=item></render></div></div></div></div>'),$templateCache.put("fluro/ui/countdown.html",""),$templateCache.put("fluro/ui/gallery.html",'<div class=gallery><div class=outer><div class=wrapper><div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents><div class="gallery-slide slide animated" ng-class={active:isActive(image)} ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-height="1200"></div></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:isActive(item)}><i class=fa ng-class="{\'fa-circle-o\':!isActive(item), \'fa-circle\':isActive(item)}"></i></a></div></div><div class=gallery-thumbs><slider><div class=gallery-thumb ng-class={active:isActive(image)} ng-click=playlist.select(image) ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-width=320 image-height="320"></div></slider></div></div></div></div>'),$templateCache.put("fluro/ui/slide.html",'<div class="slide animated" ng-class="{\'active\':active}" ng-transclude></div>'),$templateCache.put("fluro/ui/slideshow.html",'<div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents ng-transclude></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:item.active}><i class=fa ng-class="{\'fa-circle-o\':!item.active, \'fa-circle\':item.active}"></i></a></div></div>')}]);